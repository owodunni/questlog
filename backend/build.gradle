plugins {
  id "questlog.java-conventions"
}

version "0.1.0"

def depsDir = "$buildDir/extractedDpendencies"
def generatedDir = "$projectDir/questlog/generated"

configurations {
  api
}

dependencies {
  api project(path: ":api")
}

task extractDependencies(type: Copy) {
  dependsOn configurations.api
  configurations.api.asFileTree.each {
    from(tarTree(it))
  }
  into depsDir
}

task extractModels(type: Copy) {
  dependsOn extractDependencies
  fileTree(dir: depsDir, include: "**/models/*").each {
    from it
  }
  into "$generatedDir/models"
}

task extractApi(type: Copy) {
  dependsOn extractDependencies
  fileTree(dir: depsDir, include: "**/openapi.yaml" ).each {
    from it
  }
  into "$generatedDir/api"
}

task assembleBackend(){
  dependsOn extractApi, extractModels
}

task assemble{
  group "build"
  description "Assemble backend"
  dependsOn assembleBackend
}
